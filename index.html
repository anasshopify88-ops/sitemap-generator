<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1, viewport-fit=cover"/>
  <title>Ø¢Ø¯Ø§Ø© Ù…Ù†Ø´Ø¦ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Sitemap) Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f7f8fb; --bg-2:#f1f5fb; --card:#ffffff; --text:#0c1424; --muted:#5b6472;
      --accent:#2563eb; --ok:#15803d; --warn:#d97706; --error:#dc2626;
      --border:#e6e9f2; --shadow:0 6px 16px rgba(0,0,0,.08);
      --radius:16px; --radius-sm:12px;
      --sidebar-w:280px;
      --fs-base:13px; --fs-sm:11.5px; --fs-xs:10.5px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:"Cairo",system-ui,Arial,Helvetica,sans-serif; line-height:1.65;
      background:linear-gradient(180deg,var(--bg),var(--bg-2)); color:var(--text);
      -webkit-font-smoothing:antialiased; overflow-x:hidden; font-size:var(--fs-base);
    }
    .wrap{max-width:1200px;margin:0 auto;padding:24px 16px 64px}
    .topbar{display:flex;align-items:center;gap:8px;margin-bottom:12px}
    .btn{
      border:1px solid var(--border); background:linear-gradient(180deg,#fff,#f9fbff);
      color:var(--text); padding:8px 12px; border-radius:14px; cursor:pointer;
      font-weight:700; box-shadow:var(--shadow);
      transition:transform .18s ease, box-shadow .25s ease, border-color .25s ease, background .25s ease;
      font-size:12px; text-decoration:none; display:inline-flex; align-items:center; gap:6px;
      /* âœ… Ø­Ù…Ø§ÙŠØ© Ù…Ù† ØªÙ…Ø¯Ø¯ Ø§Ù„Ù†Øµ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
      overflow-wrap:anywhere; word-break:break-word; min-width:0;
    }
    .btn:hover{transform:translateY(-2px); border-color:#cbd5e1}
    .btn.primary{background:linear-gradient(135deg,#2563eb,#8b5cf6); color:#fff; border-color:transparent}
    .btn.ok{background:linear-gradient(135deg,#16a34a,#22c55e); color:#fff; border-color:transparent}
    .btn.home{background:#000; color:#fff; border-color:#000}
    .btn:disabled{opacity:.6; cursor:not-allowed}
    .card{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:14px; box-shadow:var(--shadow); min-width:0}
    .titleRow{display:flex;align-items:center;gap:10px;justify-content:space-between; min-width:0}
    h1{margin:0;font-size:clamp(18px,2.2vw,24px);font-weight:800;letter-spacing:.2px}
    .sub{margin-top:6px;color:var(--muted);font-size:var(--fs-sm)}
    .notice{margin-top:6px;font-size:12px;color:var(--error)}
    .notice a{color:var(--error);text-decoration:underline}
    .layout{
      display:grid;
      grid-template-columns: var(--sidebar-w) 1fr;
      gap:14px;
      align-items:stretch;
    }
    #sidePanel{display:flex; height:100%; min-height:0; overflow:hidden;}
    @media (min-width:981px){ #sidePanel{ contain:size; }}
    .sidebar-card{flex:1 1 auto; height:100%; display:flex; flex-direction:column; gap:10px; min-height:0; overflow:auto;}
    .avatar{width:112px;height:112px;border-radius:50%;background:#fff;padding:6px;object-fit:contain;object-position:center;border:1px solid var(--border);align-self:center}
    .logo{width:100%; max-width:180px; align-self:center; object-fit:contain; object-position:center; background:#fff; border-radius:12px; border:1px solid var(--border); padding:8px}
    .title-logo{width:180px; max-width:180px; align-self:center}
    .s-list{display:grid; gap:8px}
    .s-item a{
      display:block; padding:8px 10px; border:1px solid var(--border); border-radius:12px; background:#fff;
      color:#0f172a; text-decoration:none; font-weight:600; transition:transform .15s ease, box-shadow .2s ease, border-color .2s ease;
      box-shadow:0 4px 12px rgba(15,23,42,.05); font-size:13px;
      overflow-wrap:anywhere; word-break:break-word;
    }
    .s-item a:hover{transform:translateY(-2px); border-color:#cbd5e1; box-shadow:0 8px 18px rgba(15,23,42,.08)}
    .s-caption{color:var(--muted); font-size:11.5px; margin-top:-2px; align-self:center}
    #toolBox{display:flex; flex-direction:column; gap:10px; min-height:0}
    .panel.card label{display:block; font-size:14px; margin-bottom:6px}
    textarea{
      width:100%; background:#fff; color:#text; border:1px solid var(--border);
      border-radius:12px; padding:10px 12px; outline:none;
      min-height:140px; resize:vertical; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; line-height:1.55;
      /* âœ… Ø¬Ø¹Ù„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø·ÙˆÙŠÙ„Ø© Ù„Ø§ ØªÙƒØ³Ø± Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ + Ø§ØªØ¬Ø§Ù‡ LTR */
      overflow-wrap:anywhere; word-break:break-word; direction:ltr; text-align:left; min-width:0;
    }
    input[type="file"], input[type="url"], input[type="number"], select{
      width:100%; background:#fff; color:var(--text); border:1px solid var(--border);
      border-radius:12px; padding:10px 12px; outline:none; font-size:13px;
    }
    textarea:focus,input[type="file"]:focus,input[type="url"]:focus,input[type="number"]:focus,select:focus{box-shadow:0 0 0 3px rgba(37,99,235,.25)}
    .row{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    .grid{display:grid; gap:10px}
    /* âœ… Ù…Ù†Ø¹ ØªÙ…Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø´Ø¨ÙƒØ§Øª ÙˆØ§Ù„ØµÙÙˆÙ */
    .grid > *, .row > * { min-width:0; }
    .summary{display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-top:8px}
    .card-mini{background:#fff; border:1px solid var(--border); border-radius:12px; padding:10px}
    .card-mini .k{font-size:12px; color:var(--muted)}
    .card-mini .v{font-weight:800; font-size:18px}
    .code{
      background:#fff; border:1px solid var(--border); border-radius:12px; padding:10px; overflow:auto;
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      /* âœ… Ø£Ù‡Ù… ØªØ¹Ø¯ÙŠÙ„: Ù„ÙÙ‘ Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ø·ÙˆÙŠÙ„Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© */
      white-space:pre-wrap; line-height:1.5; max-height:300px;
      overflow-wrap:anywhere; word-break:break-word; direction:ltr; text-align:left; min-width:0;
    }
    .hl .tag{color:#0ea5e9}
    .hl .attr{color:#ef4444}
    .hl .val{color:#059669}
    .hl .cm{color:#94a3b8}
    .links-list a{display:inline-block; margin:.2rem .4rem; font-size:13px; overflow-wrap:anywhere; word-break:break-word}
    .errors{background:#fff1f2; border:1px solid #fecdd3; color:#b91c1c; border-radius:12px; padding:10px; margin-top:8px; display:none; overflow-wrap:anywhere; word-break:break-word}
    .drop{
      border:2px dashed var(--border); border-radius:12px; padding:14px; text-align:center; color:#94a3b8;
    }
    .drop.drag{border-color:#06b6d4; background:#f0fdff; color:#0e7490}
    @media (max-width:980px){
      .layout{grid-template-columns:1fr}
      #sidePanel{height:auto; overflow:visible;}
      .avatar{width:104px;height:104px}
    }
    .status{font-size:12px; color:var(--muted); margin-top:6px; overflow-wrap:anywhere; word-break:break-word}
    .badge{display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid var(--border); background:#fff; font-weight:700; font-size:11px}

    /* ğŸ”˜ Ù…ÙØ¨Ø¯Ù‘Ù„ Ø§Ù„ÙˆØ¶Ø¹ (Ø²Ø­Ù/ÙŠØ¯ÙˆÙŠ) */
    .seg{display:inline-flex; align-items:center; gap:0; border:1px solid var(--border); border-radius:999px; background:#f1f5fb; overflow:hidden}
    .seg input{display:none}
    .seg label{
      padding:6px 10px; cursor:pointer; user-select:none; font-weight:800; font-size:12px; color:var(--muted);
    }
    .seg input:checked + label{
      background:#fff; color:#text; border:1px solid var(--border); margin:-1px; border-radius:999px; box-shadow:var(--shadow);
    }
    .hint{font-size:11.5px; color:var(--muted); margin-top:4px; overflow-wrap:anywhere; word-break:break-word}
  </style>
</head>
<body>
  <div class="wrap">
    <nav class="topbar">
      <button class="btn" type="button" onclick="history.back()">Ø±Ø¬ÙˆØ¹</button>
      <a class="btn home" href="https://anasrashed.com" rel="noopener">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    </nav>

    <div class="card">
      <div class="titleRow">
        <div>
          <h1>Ø¢Ø¯Ø§Ø© Ù…Ù†Ø´Ø¦ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Sitemap) Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©</h1>
          <div class="sub">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø²Ø­Ù Ø§Ù„ÙƒØ§Ù…Ù„ Ø¯ÙÙˆÙ’Ù…ÙŠÙ‘Ù† ÙÙ‚Ø· (domain crawl) Ù…Ø¹ Ø­Ø¯ Ø£Ù‚ØµÙ‰ 2000 Ø±Ø§Ø¨Ø·.</div>
        </div>
        <img class="logo title-logo" src="https://i.imgur.com/meUEoP7.png" alt="Ø§Ù„Ø´Ø¹Ø§Ø±"
             onerror="this.onerror=null; this.src='https://i.imgur.com/meUEoP7.jpg';">
      </div>
    </div>

    <div class="layout" style="margin-top:12px">
      <aside id="sidePanel">
        <div class="card sidebar-card">
          <img class="avatar" src="https://i.imgur.com/B3UkEQ0.jpg" alt="ØµÙˆØ±ØªÙŠ" referrerpolicy="no-referrer"
               onerror="this.onerror=null; this.src='https://i.imgur.com/B3UkEQ0.png';">
          <div class="s-list">
            <div class="s-item"><a href="https://whoami.anasrashed.com" target="_blank" rel="noopener">Ù…Ù† Ø£Ù†Ø§ØŸ</a></div>
            <div class="s-item"><a href="https://anasrashed.com/wAXpVym" target="_blank" rel="noopener">Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø³ÙŠÙˆ Ø§Ù„Ø´Ø§Ù…Ù„</a></div>
            <div class="s-item"><a href="https://anasrashed.com/eQvbbqP" target="_blank" rel="noopener">Ø£ÙØ¶Ù„ Ø¨Ø§Ùƒ Ù„ÙŠÙ†Ùƒ</a></div>
            <div class="s-item"><a href="https://anasrashed.com/NApDQYD" target="_blank" rel="noopener">Ø­Ù…Ù„Ø© Ø¨Ø§Ùƒ Ù„ÙŠÙ†Ùƒ Ø´Ù‡Ø±ÙŠØ©</a></div>
            <div class="s-item"><a href="https://anasrashed.com/ZqyGaBZ" target="_blank" rel="noopener">Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù„Ø¨Ø§Ù‚Ø© Ø¨Ù„Ø³</a></div>
            <div class="s-item"><a href="https://serp.anasrashed.com" target="_blank" rel="noopener">Ø£Ø¯Ø§Ø© SERP Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¥ØµØ·Ù†Ø§Ø¹ÙŠ</a></div>
            <div class="s-item"><a href="https://smg.anasrashed.com" target="_blank" rel="noopener">Ø£Ø¯Ø§Ø© Ù…Ù†Ø´Ø¦ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹</a></div>
            <div class="s-item"><a href="https://anasrashed.com/blog" target="_blank" rel="noopener">ØªØ¹Ù„Ù… Ø£ÙƒØ«Ø±</a></div>
            <div class="s-item"><a href="https://anasrashed.com/ØªÙˆØ«ÙŠÙ‚-Ø§Ù„ØªØ¬Ø§Ø±Ø©-Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©/page-1494027497" target="_blank" rel="noopener">ØªÙˆØ«ÙŠÙ‚ Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</a></div>
            <div class="s-item"><a href="https://contact.anasrashed.com" target="_blank" rel="noopener">ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙŠ</a></div>
          </div>
        </div>
      </aside>

      <section id="toolBox">
        <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø²Ø­Ù -->
        <section class="panel card" id="crawlPanel">
          <div class="grid" style="grid-template-columns:1fr; align-items:end">
            <div>
              <label for="startUrl">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
              <input id="startUrl" type="url" placeholder="Ù…Ø«Ø§Ù„: https://example.com" inputmode="url">
            </div>
            <div class="row" style="justify-content:flex-start">
              <button id="btnCrawl" class="btn primary" type="button">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø²Ø­Ù</button>
              <button id="btnCancel" class="btn" type="button" disabled>Ø¥Ù„ØºØ§Ø¡</button>
              <span id="crawlBadge" class="badge" style="display:none">Ø¬Ø§Ø±Ù Ø§Ù„Ø²Ø­Ùâ€¦</span>
            </div>
          </div>
          <div id="crawlStatus" class="status"></div>
        </section>

        <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø·: Ø²Ø­Ù/ÙŠØ¯ÙˆÙŠ -->
        <section class="panel card">
          <div class="row" style="justify-content:space-between; align-items:flex-end">
            <div>
              <label id="lblLinksHeader" for="txtLinks" style="margin:0">Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© / Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ÙƒØªØ´ÙØ©</label>
              <div class="hint" id="modeHint">Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ÙƒØªØ´ÙØ© Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø²Ø­Ù.</div>
            </div>
            <div class="row">
              <div class="seg" role="tablist" aria-label="Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„" id="modeSeg">
                <input type="radio" name="mode" id="modeCrawl" value="crawl" checked>
                <label for="modeCrawl" role="tab" aria-controls="txtLinks">Ø²Ø­Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ</label>
                <input type="radio" name="mode" id="modeManual" value="manual">
                <label for="modeManual" role="tab" aria-controls="txtLinks">Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ</label>
              </div>
              <button id="btnBuildManual" class="btn primary" type="button" disabled>Ø¨Ù†Ø§Ø¡ Ù…Ù† Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</button>
              <!-- Ø£Ø²Ø±Ø§Ø± ÙˆØ¶Ø¹ Ø§Ù„ÙŠØ¯ÙˆÙŠ ÙÙ‚Ø· (ØªØ¸Ù‡Ø± Ø¹Ù†Ø¯ manualOnly) -->
              <button id="btnCopyIndexLite" class="btn" type="button" style="display:none" disabled>Ù†Ø³Ø® sitemap_index.xml</button>
              <button id="btnZipLite" class="btn ok" type="button" style="display:none" disabled>ØªÙ†Ø²ÙŠÙ„ ZIP</button>
              <button id="btnClear" class="btn" type="button">Ù…Ø³Ø­</button>
            </div>
          </div>

          <textarea id="txtLinks" dir="ltr" placeholder="Ù‡Ù†Ø§ ØªÙØ¹Ø±Ø¶ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¨Ø¹Ø¯ Ø§Ù„Ø²Ø­Ù ..."></textarea>
        </section>

        <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„ -->
        <section class="panel card" id="previewPanel">
          <div class="row" style="justify-content:space-between">
            <h3 style="margin:6px 0 10px">Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</h3>
            <div class="row">
              <button id="btnCopyIndex" class="btn primary" type="button" disabled>Ù†Ø³Ø® sitemap_index.xml</button>
              <button id="btnZip" class="btn ok" type="button" disabled>ØªÙ†Ø²ÙŠÙ„ sitemap ÙƒÙ€ ZIP</button>
            </div>
          </div>

          <div class="summary">
            <div class="card-mini"><div class="k">Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†Ø¸ÙŠÙ</div><div id="sumCount" class="v">0</div></div>
            <div class="card-mini"><div class="k">Ø¹Ø¯Ø¯ Ù…Ù„ÙØ§Øª Ø§Ù„Ø®Ø±Ø§Ø¦Ø·</div><div id="sumFiles" class="v">0</div></div>
            <div class="card-mini"><div class="k">Ø§Ù„Ø­Ø¬Ù… Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ</div><div id="sumSize" class="v">0 KB</div></div>
          </div>

          <div class="grid" style="margin-top:10px">
            <div>
              <label>Ù…Ù‚ØªØ·Ù XML</label>
              <div id="code" class="code hl" aria-live="polite" dir="ltr"></div>
            </div>
            <div>
              <div id="links" class="links-list">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ø¨Ø¹Ø¯.</div>
              <div id="errors" class="errors" role="alert"></div>
            </div>
          </div>
        </section>
      </section>
    </div>
  </div>

<script>
  const $ = s => document.querySelector(s);
  const toBytes = s => new TextEncoder().encode(s);
  const escapeXml = s => String(s)
    .replace(/&/g,'&amp;').replace(/</g,'&lt;')
    .replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&apos;');

  const txtLinks = $('#txtLinks');
  const btnClear = $('#btnClear');
  const btnZip = $('#btnZip');
  const btnCopyIndex = $('#btnCopyIndex');
  const sumCount = $('#sumCount');
  const sumFiles = $('#sumFiles');
  const sumSize = $('#sumSize');
  const code = $('#code');
  const links = $('#links');
  const errorsBox = $('#errors');

  const startUrlEl = $('#startUrl');
  const btnCrawl = $('#btnCrawl');
  const btnCancel = $('#btnCancel');
  const crawlStatus = $('#crawlStatus');
  const crawlBadge = $('#crawlBadge');
  const crawlPanel = $('#crawlPanel');

  const modeCrawl = $('#modeCrawl');
  const modeManual = $('#modeManual');
  const btnBuildManual = $('#btnBuildManual');
  const lblLinksHeader = $('#lblLinksHeader');
  const modeHint = $('#modeHint');
  const previewPanel = $('#previewPanel');
  const modeSeg = $('#modeSeg');

  // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¨Ø³Ù‘Ø·Ø© (ÙŠØ¯ÙˆÙŠ ÙÙ‚Ø·)
  const btnCopyIndexLite = $('#btnCopyIndexLite');
  const btnZipLite = $('#btnZipLite');

  // Ù‚Ø±Ø§Ø¡Ø© Ø¨Ø§Ø±Ø§Ù…ÙŠØªØ± Ø§Ù„Ø±Ø§Ø¨Ø· manualOnly=1 Ù„ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ "ÙŠØ¯ÙˆÙŠ ÙÙ‚Ø·" Ø¨Ø¯ÙˆÙ† Ù…Ø¹Ø§ÙŠÙ†Ø©
  const qs = new URLSearchParams(location.search);
  const isManualOnly = /^(1|true|yes|on)$/i.test(qs.get('manualOnly') || '');

  let cancelFlag = false;
  let currentMode = 'crawl'; // 'crawl' | 'manual'
  let lastBuild = null;

  function resolveUrl(u){
    u=(u||'').trim();
    if(!u) return null;
    const m = u.match(/\s#.*$/);
    if(m) u = u.slice(0, m.index).trim();
    if(/^https?:\/\//i.test(u)) return u;
    return null;
  }
  function normalize(u){
    try{
      const url = new URL(u);
      url.hash = '';
      const delKeys = ['utm_source','utm_medium','utm_campaign','utm_term','utm_content','gclid','fbclid','mc_cid','mc_eid','ref'];
      delKeys.forEach(k=> url.searchParams.delete(k));
      let s = url.toString();
      if(url.pathname !== '/' && s.endsWith('/')) s = s.slice(0,-1);
      return s;
    }catch{ return null; }
  }
  function sameHost(u, origin){
    try{
      const h1 = new URL(u).host.replace(/^www\./,'');
      const h2 = new URL(origin).host.replace(/^www\./,'');
      return h1 === h2;
    }catch{ return false; }
  }
  function extBlocked(u){
    return /\.(?:jpe?g|png|gif|webp|svg|bmp|ico|mp4|avi|mov|wmv|mkv|mp3|wav|pdf|zip|rar|7z|gz|css|js|woff2?|ttf|eot)(\?|#|$)/i.test(u);
  }

  // ====== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ (Ø´ÙƒÙ„ ?url=) ======
  const PROXY_PREFIX = 'https://sitemap-generator.anasshopify88.workers.dev';
  function proxify(u){
    return PROXY_PREFIX + '?url=' + encodeURIComponent(u);
  }

  async function fetchText(u){
    try{
      const r = await fetch(u, {credentials:'omit', cache:'no-cache', redirect:'follow'});
      if(r.ok) return await r.text();
    }catch{}
    try{
      const r = await fetch(proxify(u), {credentials:'omit', cache:'no-cache', redirect:'follow'});
      if(r.ok) return await r.text();
    }catch{}
    throw new Error('ØªØ¹Ø°Ù‘Ø± Ù‚Ø±Ø§Ø¡Ø©: '+u);
  }

  async function fetchOk(u){
    try{
      const r = await fetch(u, {method:'HEAD', credentials:'omit', cache:'no-cache', redirect:'follow'});
      if(r.ok) return true;
    }catch{}
    try{
      const r = await fetch(proxify(u), {method:'HEAD', credentials:'omit', cache:'no-cache', redirect:'follow'});
      if(r.ok) return true;
    }catch{}
    return false;
  }

  const sleep = ms => new Promise(r=> setTimeout(r, ms));

  async function readRobots(origin){
    const url = new URL('/robots.txt', origin).toString();
    try{
      const txt = await fetchText(url);
      const lines = txt.split(/\r?\n/).map(l=>l.trim());
      const rules = {disallow:[], allow:[]};
      let active = false;
      for(const ln of lines){
        if(/^user-agent:\s*\*/i.test(ln)){ active = true; continue; }
        if(/^user-agent:/i.test(ln) && !/^user-agent:\s*\*/i.test(ln)){ active = false; continue; }
        if(!active) continue;
        const mD = ln.match(/^disallow:\s*(.*)$/i);
        const mA = ln.match(/^allow:\s*(.*)$/i);
        if(mD){ rules.disallow.push((mD[1]||'').trim()); }
        if(mA){ rules.allow.push((mA[1]||'').trim()); }
      }
      return path => {
        const allowHit = rules.allow.some(p=> p && path.startsWith(p));
        const disHit = rules.disallow.some(p=> p && path.startsWith(p));
        if(allowHit) return true;
        if(disHit) return false;
        return true;
      };
    }catch{
      return () => true;
    }
  }

  async function crawlDomain(start, limit=2000){
    const origin = new URL(start).origin;
    const allowPath = await readRobots(origin);
    const q = [ normalize(start) ];
    const seen = new Set();
    const out = new Set();

    // â›”ï¸ Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª (Ø£Ø¶ÙÙ†Ø§ tag/tags Ù‡Ù†Ø§)
    const EXCLUDE_PATTERNS = [
      /\/(cart|checkout|login|account|orders|admin|wp-admin|cdn-cgi)(\/|$)/i,
      /(^|\/)(tag|tags)(\/|$)/i
    ];

    const CONCURRENCY = 3;
    let active = 0;

    updateStatus('Ø¨Ø¯Ø¡ Ø§Ù„Ø²Ø­Ùâ€¦');

    async function worker(){
      while(q.length && !cancelFlag && out.size < limit){
        const url = q.shift();
        if(!url || seen.has(url)) continue;
        seen.add(url);

        try{
          const uo = new URL(url);
          if(!allowPath(uo.pathname)) continue;
          if(EXCLUDE_PATTERNS.some(rx=> rx.test(uo.pathname))) continue;

          active++;
          const html = await fetchText(url);

          let canonical = null;
          try{
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');

            const metaRobots = doc.querySelector('meta[name="robots"]');
            if(metaRobots && /noindex/i.test(metaRobots.getAttribute('content')||'')){
              // ØªØ¬Ø§Ù‡Ù„ Ù„Ùˆ noindex
            } else {
              const linkCanonical = doc.querySelector('link[rel="canonical"]');
              if(linkCanonical && linkCanonical.href){
                canonical = normalize(linkCanonical.href);
              }
              const anchors = Array.from(doc.querySelectorAll('a[href]')).map(a=> a.getAttribute('href'));
              for(const h of anchors){
                if(!h) continue;
                let abs;
                try{ abs = new URL(h, url).toString(); } catch{ continue; }
                if(!sameHost(abs, origin)) continue;
                if(extBlocked(abs)) continue;
                const n = normalize(abs);
                if(!n || seen.has(n) || out.size + q.length >= limit) continue;

                // âœ‚ï¸ ÙÙ„ØªØ±Ø© tag/tags Ù‚Ø¨Ù„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§Ø¨ÙˆØ±:
                try{
                  const pn = new URL(n).pathname;
                  if(EXCLUDE_PATTERNS.some(rx=> rx.test(pn))) continue;
                }catch{}
                q.push(n);
              }
            }
          }catch{}

          const finalUrl = (canonical && sameHost(canonical, origin)) ? canonical : url;

          if(!extBlocked(finalUrl)){
            // âœ‚ï¸ ÙÙ„ØªØ±Ø© tag/tags Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:
            try{
              const pf = new URL(finalUrl).pathname;
              if(!EXCLUDE_PATTERNS.some(rx=> rx.test(pf))){
                out.add(finalUrl);
              }
            }catch{
              out.add(finalUrl);
            }
          }

          updateStatus(`Ù…ÙƒØªØ´ÙØ©: ${out.size} / Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: ${q.length} Ø±ÙˆØ§Ø¨Ø·`);
          await sleep(150);
        }catch(e){
          // ØªØ¬Ø§Ù‡Ù„ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØµÙØ­Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©
        }finally{
          active--;
        }
      }
    }

    const workers = Array.from({length:CONCURRENCY}, ()=> worker());
    await Promise.race([
      Promise.all(workers),
      new Promise(res => {
        const t = setInterval(()=>{
          if((!q.length && active===0) || cancelFlag || out.size >= limit){
            clearInterval(t);
            res();
          }
        }, 200);
      })
    ]);

    if(cancelFlag) cancelFlag = false;
    return Array.from(out);
  }

  function parseInputsFromList(lines){
    const seen = new Set();
    const out = [];
    for(const u of lines){
      const nu = normalize(u);
      if(nu && !seen.has(nu)){
        seen.add(nu);
        out.push({ url: nu, changefreq: 'daily' });
      }
    }
    return out;
  }

  function buildSitemapsFromUrls(urls){
    const records = parseInputsFromList(urls);
    const CHUNK = 50000;
    const chunks = [];
    for(let i=0;i<records.length;i+=CHUNK){
      chunks.push(records.slice(i,i+CHUNK));
    }

    const nsBase = 'http://www.sitemaps.org/schemas/sitemap/0.9';
    const urlsetOpen = () => `<?xml version="1.0" encoding="UTF-8"?>\n<urlset xmlns="${nsBase}">\n`;
    const urlEntry = it => {
      let xml = `  <url>\n    <loc>${escapeXml(it.url)}</loc>\n`;
      if(it.changefreq){
        xml += `    <changefreq>${escapeXml(it.changefreq)}</changefreq>\n`;
      }
      xml += `  </url>\n`;
      return xml;
    };

    const files = [];
    for(let i=0; i<chunks.length; i++){
      let xml = urlsetOpen();
      for(const it of chunks[i]) xml += urlEntry(it);
      xml += `</urlset>\n`;
      const name = (chunks.length === 1) ? 'sitemap.xml' : `sitemap-${i+1}.xml`;
      files.push({ name, xml });
    }

    let indexXml = '';
    if(files.length > 1){
      indexXml = `<?xml version="1.0" encoding="UTF-8"?>\n<sitemapindex xmlns="${nsBase}">\n`;
      const last = new Date().toISOString().slice(0,10);
      for(const f of files){
        indexXml += `  <sitemap>\n    <loc>${escapeXml(f.name)}</loc>\n    <lastmod>${last}</lastmod>\n  </sitemap>\n`;
      }
      indexXml += `</sitemapindex>\n`;
      files.push({ name: 'sitemap_index.xml', xml: indexXml });
    }

    const approxSize = files.reduce((s,f)=> s + new TextEncoder().encode(f.xml).length, 0);
    return { files, indexXml, count: records.length, approxSize, errors: [] };
  }

  function updatePreview(filesObj){
    const { files, indexXml, count, approxSize } = filesObj;
    lastBuild = { files, indexXml };

    // Ø¥Ù† ÙƒØ§Ù† Ø§Ù„ÙˆØ¶Ø¹ "ÙŠØ¯ÙˆÙŠ ÙÙ‚Ø·" ÙÙ„Ø§ Ù†Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©ØŒ Ù„ÙƒÙ† Ù†Ø­Ø¯Ù‘Ø« Ø­Ø§Ù„Ø§Øª Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¨Ø³Ø·Ø©
    if(isManualOnly){
      const hasFiles = files.length > 0;
      btnZipLite.disabled = !hasFiles;
      btnCopyIndexLite.disabled = !hasFiles;
      updateStatus(hasFiles
        ? `ØªÙ… Ø§Ù„Ø¨Ù†Ø§Ø¡ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ. Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†Ø¸ÙŠÙ: ${count}.`
        : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ø¨Ø¹Ø¯.');
      return;
    }

    // Ø§Ù„ØªØµØ±Ù‘Ù Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ù…Ø¹ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©)
    links.innerHTML = '';
    errorsBox.style.display = 'none';
    sumCount.textContent = String(count);
    sumFiles.textContent = String(files.length);
    sumSize.textContent = (approxSize / 1024).toFixed(1) + ' KB';

    if(files.length){
      const first = files[0].xml;
      code.textContent = first.slice(0,6000);
      for(const f of files){
        const a = document.createElement('a');
        a.href = URL.createObjectURL(new Blob([f.xml], {type:'application/xml'}));
        a.download = f.name;
        a.textContent = `ØªÙ†Ø²ÙŠÙ„ ${f.name}`;
        a.className = 'btn';
        a.style.margin='6px 6px 0 0';
        links.appendChild(a);
      }
    } else {
      code.textContent = '';
      links.textContent = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ø¨Ø¹Ø¯.';
    }
    btnZip.disabled = files.length === 0;
    btnCopyIndex.disabled = files.length === 0;
  }

  function buildFromManual(){
    const lines = txtLinks.value.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
    if(!lines.length){
      updateStatus('Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø£ÙŠ Ø±ÙˆØ§Ø¨Ø·. Ø£Ù„ØµÙ‚ ÙƒÙ„ Ø±Ø§Ø¨Ø· ÙÙŠ Ø³Ø·Ø± Ø«Ù… Ø§Ø¶ØºØ· "Ø¨Ù†Ø§Ø¡ Ù…Ù† Ø§Ù„Ø±ÙˆØ§Ø¨Ø·".');
      updatePreview({files:[], indexXml:'', count:0, approxSize:0, errors:[]});
      return;
    }
    const sitemapObj = buildSitemapsFromUrls(lines);
    updatePreview(sitemapObj);
    if(!isManualOnly){
      updateStatus(`ØªÙ… Ø§Ù„Ø¨Ù†Ø§Ø¡ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ. Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†Ø¸ÙŠÙ: ${sitemapObj.count}.`);
    }
  }

  // ========= ÙˆØ¶Ø¹ "Ø²Ø­Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ" =========
  btnCrawl.addEventListener('click', async () => {
    if(currentMode !== 'crawl'){
      updateStatus('ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù…ÙÙØ¹Ù„ØŒ ÙØ¹Ù‘Ù„ "Ø²Ø­Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ" Ù„Ù„Ø²Ø­Ù.');
      return;
    }
    const start = resolveUrl(startUrlEl.value);
    if(!start){
      updateStatus('ÙØ¶Ù„Ø§Ù‹ Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØµØ­ÙŠØ­ ÙŠØ¨Ø¯Ø£ Ø¨Ù€ https:// Ø£Ùˆ http://');
      return;
    }
    btnCrawl.disabled = true;
    btnCancel.disabled = false;
    crawlBadge.style.display = 'inline-block';
    updateStatus('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø²Ø­Ùâ€¦');

    try {
      const urls = await crawlDomain(start, 2000);
      updateStatus(`ØªÙ… Ø§ÙƒØªØ´Ø§Ù ${urls.length} Ø±Ø§Ø¨Ø· Ø¨Ø¹Ø¯ Ø§Ù„Ø²Ø­Ù.`);
      txtLinks.value = urls.join('\n');
      const sitemapObj = buildSitemapsFromUrls(urls);
      updatePreview(sitemapObj);
      updateStatus(`ØªÙ…! Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†Ø¸ÙŠÙ: ${sitemapObj.count}.`);
    } catch(e){
      updateStatus('ÙØ´Ù„ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø²Ø­Ù: ' + (e.message || e));
    } finally {
      btnCrawl.disabled = false;
      btnCancel.disabled = true;
      crawlBadge.style.display = 'none';
    }
  });

  btnCancel.addEventListener('click', () => {
    cancelFlag = true;
    updateStatus('ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡.');
  });

  // ========= ÙˆØ¶Ø¹ "Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ" =========
  btnBuildManual.addEventListener('click', buildFromManual);
  txtLinks.addEventListener('keydown', (e)=>{
    if(currentMode==='manual' && (e.metaKey||e.ctrlKey) && e.key==='Enter'){
      e.preventDefault(); buildFromManual();
    }
  });
  txtLinks.addEventListener('input', ()=>{
    btnBuildManual.disabled = currentMode!=='manual' || txtLinks.value.trim().length===0;
    if(isManualOnly){
      btnCopyIndexLite.disabled = true;
      btnZipLite.disabled = true;
    }
  });

  // ========= Ø¹Ø§Ù… =========
  btnClear.addEventListener('click', () => {
    txtLinks.value = '';
    sumCount.textContent = '0';
    sumFiles.textContent = '0';
    sumSize.textContent = '0 KB';
    links.innerHTML = '';
    code.textContent = '';
    btnZip.disabled = true;
    btnCopyIndex.disabled = true;
    if(isManualOnly){
      btnZipLite.disabled = true;
      btnCopyIndexLite.disabled = true;
    }
    if(currentMode==='manual'){
      updateStatus('ØªÙ… Ø§Ù„Ù…Ø³Ø­. Ø£Ù„ØµÙ‚ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø«Ù… Ø§Ø¶ØºØ· "Ø¨Ù†Ø§Ø¡ Ù…Ù† Ø§Ù„Ø±ÙˆØ§Ø¨Ø·".');
      btnBuildManual.disabled = true;
    }else{
      updateStatus('ØªÙ… Ø§Ù„Ù…Ø³Ø­.');
    }
  });

  // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¨Ø³Ù‘Ø·Ø© ØªØ¹ÙŠØ¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙØ³ Ù…Ù†Ø·Ù‚ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
  btnCopyIndex.addEventListener('click', async () => {
    if(!lastBuild) return;
    try {
      await navigator.clipboard.writeText(lastBuild.indexXml || '');
      btnCopyIndex.textContent = 'ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“';
      setTimeout(() => btnCopyIndex.textContent = 'Ù†Ø³Ø® sitemap_index.xml', 1200);
    } catch {
      const w = window.open();
      if(w){
        w.document.write('<pre>' + escapeXml(lastBuild.indexXml || '') + '</pre>');
        w.document.close();
      }
    }
  });
  btnZip.addEventListener('click', () => {
    if(!lastBuild || !lastBuild.files.length) return;
    const files = lastBuild.files.map(f => ({ name: f.name, data: toBytes(f.xml) }));
    const now = new Date();
    const ts = now.getFullYear().toString()
               + String(now.getMonth()+1).padStart(2, '0')
               + String(now.getDate()).padStart(2, '0') + '-'
               + String(now.getHours()).padStart(2, '0')
               + String(now.getMinutes()).padStart(2, '0');
    const blob = buildZipBlob(files);
    downloadBlob(blob, `sitemaps-${ts}.zip`);
  });

  // Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø¨Ø³Ø·Ø© Ø¨Ù†ÙØ³ Ø§Ù„Ø£ÙØ¹Ø§Ù„
  btnCopyIndexLite.addEventListener('click', () => btnCopyIndex.click());
  btnZipLite.addEventListener('click', () => btnZip.click());

  function downloadBlob(blob, filename){
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    URL.revokeObjectURL(a.href);
    a.remove();
  }

  function updateStatus(msg){
    crawlStatus.textContent = msg || '';
  }

  // ====== Ù…Ù†Ø´Ø¦ ZIP (ÙƒØ§Ù…Ù„) ======
  function buildZipBlob(files){
    const encoder = new TextEncoder();
    const writeU32 = (buf, off, v) => { buf[off]=v&255; buf[off+1]=(v>>>8)&255; buf[off+2]=(v>>>16)&255; buf[off+3]=(v>>>24)&255; };
    const writeU16 = (buf, off, v) => { buf[off]=v&255; buf[off+1]=(v>>>8)&255; };

    const crcTable = (()=>{ const t=new Uint32Array(256); for(let n=0;n<256;n++){ let c=n; for(let k=0;k<8;k++){ c=(c&1)?(0xEDB88320^(c>>>1)):(c>>>1); } t[n]=c>>>0;} return t; })();
    const crc32 = (u8)=>{ let c=0xFFFFFFFF; for(let i=0;i<u8.length;i++){ c=crcTable[(c^u8[i])&0xFF]^(c>>>8);} return (c^0xFFFFFFFF)>>>0; };

    const localParts=[], centralParts=[];
    let offset=0;

    for(const f of files){
      const nameBytes = encoder.encode(f.name);
      const data = f.data instanceof Uint8Array ? f.data : new Uint8Array(f.data);
      const crc = crc32(data);
      const comp = data;
      const compSize = comp.length, uncompSize = data.length;

      const LFH = new Uint8Array(30 + nameBytes.length);
      writeU32(LFH,0,0x04034b50); writeU16(LFH,4,20); writeU16(LFH,6,0); writeU16(LFH,8,0);
      writeU16(LFH,10,0); writeU16(LFH,12,0);
      writeU32(LFH,14,crc); writeU32(LFH,18,compSize); writeU32(LFH,22,uncompSize);
      writeU16(LFH,26,nameBytes.length); writeU16(LFH,28,0);
      LFH.set(nameBytes,30);

      localParts.push(LFH, comp);
      const localOffset = offset;
      offset += LFH.length + comp.length;

      const CDH = new Uint8Array(46 + nameBytes.length);
      writeU32(CDH,0,0x02014b50); writeU16(CDH,4,20); writeU16(CDH,6,20); writeU16(CDH,8,0); writeU16(CDH,10,0);
      writeU16(CDH,12,0); writeU16(CDH,14,0);
      writeU32(CDH,16,crc); writeU32(CDH,20,compSize); writeU32(CDH,24,uncompSize);
      writeU16(CDH,28,nameBytes.length); writeU16(CDH,30,0); writeU16(CDH,32,0);
      writeU16(CDH,34,0); writeU16(CDH,36,0); writeU32(CDH,38,0);
      writeU32(CDH,42,localOffset);
      CDH.set(nameBytes,46);
      centralParts.push(CDH);
    }

    const localLen = localParts.reduce((s,a)=> s + a.length, 0);
    const centralLen = centralParts.reduce((s,a)=> s + a.length, 0);

    const END = new Uint8Array(22);
    writeU32(END,0,0x06054b50); writeU16(END,4,0); writeU16(END,6,0);
    writeU16(END,8,centralParts.length); writeU16(END,10,centralParts.length);
    writeU32(END,12,centralLen); writeU32(END,16,localLen); writeU16(END,20,0);

    const all = new Uint8Array(localLen + centralLen + END.length);
    let p=0; for(const part of localParts){ all.set(part,p); p+=part.length; }
    for(const part of centralParts){ all.set(part,p); p+=part.length; }
    all.set(END,p);

    return new Blob([all], {type:'application/zip'});
  }

  // ====== ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ ÙˆØ§Ø¬Ù‡Ø©Ù‹ ======
  function applyModeUi(){
    if(modeCrawl.checked){ currentMode = 'crawl'; }
    if(modeManual.checked){ currentMode = 'manual'; }

    const isManual = currentMode === 'manual';

    // Ù„ÙˆØ­Ø© Ø§Ù„Ø²Ø­Ù
    startUrlEl.disabled = isManual;
    btnCrawl.disabled = isManual;
    btnCancel.disabled = true;
    crawlBadge.style.display = 'none';

    // Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
    txtLinks.readOnly = !isManual;
    txtLinks.placeholder = isManual
      ? 'Ø£Ù„ØµÙ‚ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù‡Ù†Ø§â€¦ Ø¶Ø¹ ÙƒÙ„ Ø±Ø§Ø¨Ø· ÙÙŠ Ø³Ø·Ø± Ù…Ø³ØªÙ‚Ù„.'
      : 'Ù‡Ù†Ø§ ØªÙØ¹Ø±Ø¶ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¨Ø¹Ø¯ Ø§Ù„Ø²Ø­Ù ...';

    lblLinksHeader.textContent = isManual ? 'Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ' : 'Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© / Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ÙƒØªØ´ÙØ©';
    modeHint.textContent = isManual
      ? 'Ø£Ù„ØµÙ‚ Ø±ÙˆØ§Ø¨Ø·Ùƒ ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ø«Ù… Ø§Ø¶ØºØ· "Ø¨Ù†Ø§Ø¡ Ù…Ù† Ø§Ù„Ø±ÙˆØ§Ø¨Ø·" (Ctrl/âŒ˜ + Enter).'
      : 'Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ÙƒØªØ´ÙØ© Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø²Ø­Ù.';

    btnBuildManual.disabled = !isManual || txtLinks.value.trim().length===0;

    updateStatus(isManual ? 'ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù…ÙÙØ¹Ù‘Ù„.' : 'ÙˆØ¶Ø¹ Ø§Ù„Ø²Ø­Ù Ù…ÙÙØ¹Ù‘Ù„.');
  }

  // ØªØ·Ø¨ÙŠÙ‚ ÙˆØ¶Ø¹ "ÙŠØ¯ÙˆÙŠ ÙÙ‚Ø·" Ø¥Ù† Ø·ÙÙ„ÙØ¨ Ø¹Ø¨Ø± Ø§Ù„Ø±Ø§Ø¨Ø·
  function applyManualOnlyUi(){
    if(!isManualOnly) return;
    modeManual.checked = true;
    modeCrawl.checked = false;
    currentMode = 'manual';
    applyModeUi();

    if(modeSeg) modeSeg.style.display = 'none';
    crawlPanel.style.display = 'none';
    if(previewPanel) previewPanel.style.display = 'none';

    btnCopyIndexLite.style.display = 'inline-flex';
    btnZipLite.style.display = 'inline-flex';
    btnCopyIndexLite.disabled = true;
    btnZipLite.disabled = true;

    lblLinksHeader.textContent = 'Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ';
    modeHint.textContent = 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¨Ø³Ù‘Ø· Ù…ÙÙØ¹Ù‘Ù„ Ø¹Ø¨Ø± Ø§Ù„Ø±Ø§Ø¨Ø·: Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ ÙÙ‚Ø· Ø¨Ù„Ø§ Ù…Ø¹Ø§ÙŠÙ†Ø©. Ø§Ù„ØµÙ‚ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø«Ù… Ø§Ø¶ØºØ· "Ø¨Ù†Ø§Ø¡ Ù…Ù† Ø§Ù„Ø±ÙˆØ§Ø¨Ø·".';
    updateStatus('ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ ÙÙ‚Ø· (Ø¨Ø¯ÙˆÙ† Ù…Ø¹Ø§ÙŠÙ†Ø©) Ù…ÙÙØ¹Ù‘Ù„.');
  }

  // ØªØ±ØªÙŠØ¨ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
  modeCrawl.addEventListener('change', applyModeUi);
  modeManual.addEventListener('change', applyModeUi);
  applyModeUi();          // ØªÙ‡ÙŠØ¦Ø© Ø£ÙˆÙ„ÙŠØ© Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
  applyManualOnlyUi();    // Ù‚Ø¯ ØªØ¹Ø¯Ù‘Ù„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¥Ù† ÙƒØ§Ù† manualOnly=1 ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·
</script>

</body>
</html>
